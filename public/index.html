<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Northern Wisconsin Snow Forecast</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Northern Wisconsin Snow Forecast</h1>
            <p class="subtitle">Phelps | Land O'Lakes | Eagle River</p>
            <p class="updated" id="updated"></p>
        </header>

        <section class="forecast-grid" id="forecast-grid">
            <!-- Forecast cards will be inserted here -->
        </section>

        <section class="summary" id="summary">
            <!-- Summary will be inserted here -->
        </section>

        <section class="observations">
            <h2>Recent Observations</h2>
            <div id="observations-list">
                <!-- Observations will be inserted here -->
            </div>
        </section>

        <footer>
            <p>Data updates daily at 6:00 AM and 5:30 PM CST</p>
            <p>Powered by Open-Meteo API | Global Teleconnection Forecast System</p>
        </footer>
    </div>

    <script>
        async function loadForecast() {
            try {
                const response = await fetch('latest_forecast.json');
                const data = await response.json();
                renderForecast(data);
            } catch (error) {
                document.getElementById('forecast-grid').innerHTML =
                    '<p class="error">Unable to load forecast data. Please try again later.</p>';
                console.error('Error loading forecast:', error);
            }
        }

        function renderForecast(data) {
            // Update timestamp
            document.getElementById('updated').textContent =
                `Last updated: ${data.generated_at_human}`;

            // Render forecast cards
            const grid = document.getElementById('forecast-grid');
            grid.innerHTML = data.forecasts.map(forecast => `
                <div class="forecast-card ${forecast.alert_level.toLowerCase()}">
                    <div class="day">${forecast.day_of_week}</div>
                    <div class="date">${formatDate(forecast.date)}</div>
                    <div class="icon">${forecast.icon}</div>
                    <div class="probability">${forecast.probability}%</div>
                    <div class="event-type">${forecast.event_type}</div>
                    <div class="snowfall">${forecast.expected_snowfall}</div>
                    <div class="confidence">Confidence: ${forecast.confidence}</div>
                </div>
            `).join('');

            // Render summary
            document.getElementById('summary').innerHTML = `
                <pre>${data.summary_text}</pre>
            `;

            // Render observations
            const obsList = document.getElementById('observations-list');
            if (data.recent_observations && data.recent_observations.length > 0) {
                obsList.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Station</th>
                                <th>Date</th>
                                <th>Snowfall</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.recent_observations.slice(0, 10).map(obs => `
                                <tr>
                                    <td>${obs.station}</td>
                                    <td>${obs.date}</td>
                                    <td>${obs.snowfall_inches}" (${obs.snowfall_mm}mm)</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else {
                obsList.innerHTML = '<p>No recent observations available.</p>';
            }
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        // Load forecast on page load
        loadForecast();

        // Refresh every 30 minutes
        setInterval(loadForecast, 30 * 60 * 1000);
    </script>
</body>
</html>
